{"ast":null,"code":"var _jsxFileName = \"/Users/Dascupt/happysing_aws/frontend/src/pages/Generator.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport './Home.css'; // Import gradient styles\nimport { LightBulbIcon } from '@heroicons/react/24/outline';\n\n// 定义选择工具类型\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nvar SelectionTool = /*#__PURE__*/function (SelectionTool) {\n  SelectionTool[\"RECTANGLE\"] = \"rectangle\";\n  SelectionTool[\"LASSO\"] = \"lasso\";\n  SelectionTool[\"NONE\"] = \"none\";\n  return SelectionTool;\n}(SelectionTool || {}); // 定义选择区域的接口\nconst Generator = () => {\n  _s();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const state = location.state;\n  const [refinedPrompt, setRefinedPrompt] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [selectedImage, setSelectedImage] = useState('');\n  const [showMindmapButton, setShowMindmapButton] = useState(false);\n\n  // Canvas相关状态\n  const canvasRef = useRef(null);\n  const imageRef = useRef(null);\n  const [activeTool, setActiveTool] = useState(SelectionTool.NONE);\n  const [isSelecting, setIsSelecting] = useState(false);\n  const [selectionArea, setSelectionArea] = useState(null);\n  const [startPoint, setStartPoint] = useState(null);\n  const [lassoPoints, setLassoPoints] = useState([]);\n  const [editingPrompt, setEditingPrompt] = useState('');\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  // Mock images for demonstration\n  const mockImages = ['/assets/design1.jpg', '/assets/design1.jpg', '/assets/design1.jpg'];\n  useEffect(() => {\n    // Try to restore from localStorage if state is missing\n    if (!(state !== null && state !== void 0 && state.prompt)) {\n      const storedState = localStorage.getItem('generator-last-state');\n      if (storedState) {\n        try {\n          const parsedState = JSON.parse(storedState);\n          if (parsedState && parsedState.prompt) {\n            console.log('Restored state from localStorage:', parsedState);\n            // Use the location.state setter provided by react-router\n            const loc = {\n              ...location,\n              state: parsedState\n            };\n            navigate(location.pathname, {\n              state: parsedState,\n              replace: true\n            });\n            return;\n          }\n        } catch (error) {\n          console.error('Error restoring state from localStorage:', error);\n        }\n      }\n\n      // If no valid state was found in localStorage, redirect to home\n      console.log('No valid state found, redirecting to home');\n      navigate('/');\n      return;\n    }\n\n    // Save current state to localStorage for recovery\n    try {\n      localStorage.setItem('generator-last-state', JSON.stringify(state));\n    } catch (error) {\n      console.error('Error saving state to localStorage:', error);\n    }\n    const simulatePromptRefinement = async () => {\n      setLoading(true);\n      // Simulate API call delay\n      await new Promise(resolve => setTimeout(resolve, 1500));\n\n      // Mock refined prompt\n      setRefinedPrompt(`${state.prompt} - 現代風格 - 鋁合金材質 - RGB燈效`);\n      setLoading(false);\n\n      // Show mindmap button after content is loaded\n      setShowMindmapButton(true);\n    };\n    simulatePromptRefinement();\n  }, [state, navigate, location.pathname]);\n\n  // 选择图片后加载到Canvas\n  useEffect(() => {\n    if (selectedImage && canvasRef.current) {\n      loadImageToCanvas(selectedImage);\n    }\n  }, [selectedImage]);\n\n  // 加载图片到Canvas\n  const loadImageToCanvas = src => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n    const img = new Image();\n    img.crossOrigin = 'anonymous';\n    img.onload = () => {\n      // 设置Canvas尺寸与图片一致\n      canvas.width = img.width;\n      canvas.height = img.height;\n\n      // 清除Canvas并绘制图片\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n\n      // 保存图片引用\n      imageRef.current = img;\n    };\n    img.src = src;\n  };\n  const handleImageSelect = imageUrl => {\n    setSelectedImage(imageUrl);\n    // 重置选区\n    setSelectionArea(null);\n    setActiveTool(SelectionTool.NONE);\n  };\n  const handleBackToPrompt = () => {\n    // Navigate back to the appropriate product page based on the product type\n    if (state !== null && state !== void 0 && state.productType) {\n      navigate(`/${state.productType}`);\n    } else {\n      navigate('/');\n    }\n  };\n  const handleViewMindmap = () => {\n    navigate('/mindmap', {\n      state: {\n        productType: (state === null || state === void 0 ? void 0 : state.productType) || 'cooler',\n        initialPrompt: state === null || state === void 0 ? void 0 : state.prompt\n      }\n    });\n  };\n\n  // Canvas 鼠标事件处理\n  const handleMouseDown = e => {\n    if (activeTool === SelectionTool.NONE || !canvasRef.current) return;\n    setIsSelecting(true);\n    const canvas = canvasRef.current;\n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    setStartPoint({\n      x,\n      y\n    });\n    if (activeTool === SelectionTool.LASSO) {\n      setLassoPoints([{\n        x,\n        y\n      }]);\n    }\n  };\n  const handleMouseMove = e => {\n    if (!isSelecting || !canvasRef.current || !startPoint) return;\n    const canvas = canvasRef.current;\n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    if (activeTool === SelectionTool.RECTANGLE) {\n      drawSelectionPreview({\n        x: startPoint.x,\n        y: startPoint.y,\n        width: x - startPoint.x,\n        height: y - startPoint.y,\n        type: SelectionTool.RECTANGLE\n      });\n    } else if (activeTool === SelectionTool.LASSO) {\n      const newPoints = [...lassoPoints, {\n        x,\n        y\n      }];\n      setLassoPoints(newPoints);\n      drawLassoPreview(newPoints);\n    }\n  };\n  const handleMouseUp = e => {\n    if (!isSelecting || !canvasRef.current || !startPoint) return;\n    setIsSelecting(false);\n    const canvas = canvasRef.current;\n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    if (activeTool === SelectionTool.RECTANGLE) {\n      setSelectionArea({\n        x: startPoint.x,\n        y: startPoint.y,\n        width: x - startPoint.x,\n        height: y - startPoint.y,\n        type: SelectionTool.RECTANGLE\n      });\n    } else if (activeTool === SelectionTool.LASSO && lassoPoints.length > 2) {\n      // 闭合套索\n      const closedPoints = [...lassoPoints, lassoPoints[0]];\n      setLassoPoints(closedPoints);\n      setSelectionArea({\n        x: Math.min(...closedPoints.map(p => p.x)),\n        y: Math.min(...closedPoints.map(p => p.y)),\n        points: closedPoints,\n        type: SelectionTool.LASSO\n      });\n    }\n    redrawCanvas();\n  };\n\n  // 绘制矩形选择预览\n  const drawSelectionPreview = selection => {\n    const canvas = canvasRef.current;\n    if (!canvas || !selection.width || !selection.height) return;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    // 重绘原图\n    redrawCanvas();\n\n    // 绘制选择矩形\n    ctx.strokeStyle = '#ff0000';\n    ctx.lineWidth = 2;\n    ctx.setLineDash([5, 5]);\n    ctx.strokeRect(selection.x, selection.y, selection.width, selection.height);\n\n    // 创建半透明遮罩\n    ctx.fillStyle = 'rgba(255, 0, 0, 0.2)';\n    ctx.fillRect(selection.x, selection.y, selection.width, selection.height);\n  };\n\n  // 绘制套索选择预览\n  const drawLassoPreview = points => {\n    const canvas = canvasRef.current;\n    if (!canvas || points.length < 2) return;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    // 重绘原图\n    redrawCanvas();\n\n    // 绘制套索路径\n    ctx.beginPath();\n    ctx.moveTo(points[0].x, points[0].y);\n    for (let i = 1; i < points.length; i++) {\n      ctx.lineTo(points[i].x, points[i].y);\n    }\n    ctx.strokeStyle = '#ff0000';\n    ctx.lineWidth = 2;\n    ctx.setLineDash([5, 5]);\n    ctx.stroke();\n\n    // 如果点足够多，填充半透明遮罩\n    if (points.length > 2) {\n      ctx.fillStyle = 'rgba(255, 0, 0, 0.2)';\n      ctx.fill();\n    }\n  };\n\n  // 重绘Canvas\n  const redrawCanvas = () => {\n    const canvas = canvasRef.current;\n    const img = imageRef.current;\n    if (!canvas || !img) return;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    // 清除画布\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // 绘制图片\n    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n\n    // 绘制当前选区\n    if (selectionArea) {\n      if (selectionArea.type === SelectionTool.RECTANGLE && selectionArea.width && selectionArea.height) {\n        ctx.strokeStyle = '#ff0000';\n        ctx.lineWidth = 2;\n        ctx.setLineDash([5, 5]);\n        ctx.strokeRect(selectionArea.x, selectionArea.y, selectionArea.width, selectionArea.height);\n        ctx.fillStyle = 'rgba(255, 0, 0, 0.2)';\n        ctx.fillRect(selectionArea.x, selectionArea.y, selectionArea.width, selectionArea.height);\n      } else if (selectionArea.type === SelectionTool.LASSO && selectionArea.points && selectionArea.points.length > 2) {\n        ctx.beginPath();\n        ctx.moveTo(selectionArea.points[0].x, selectionArea.points[0].y);\n        for (let i = 1; i < selectionArea.points.length; i++) {\n          ctx.lineTo(selectionArea.points[i].x, selectionArea.points[i].y);\n        }\n        ctx.strokeStyle = '#ff0000';\n        ctx.lineWidth = 2;\n        ctx.setLineDash([5, 5]);\n        ctx.stroke();\n        ctx.fillStyle = 'rgba(255, 0, 0, 0.2)';\n        ctx.fill();\n      }\n    }\n  };\n\n  // 取消选择\n  const cancelSelection = () => {\n    setSelectionArea(null);\n    setActiveTool(SelectionTool.NONE);\n    redrawCanvas();\n  };\n\n  // 获取选区图像数据\n  const getSelectionImageData = () => {\n    const canvas = canvasRef.current;\n    if (!canvas || !selectionArea) return null;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return null;\n    if (selectionArea.type === SelectionTool.RECTANGLE && selectionArea.width && selectionArea.height) {\n      // 获取矩形区域的图像数据\n      return ctx.getImageData(selectionArea.x, selectionArea.y, selectionArea.width, selectionArea.height);\n    } else if (selectionArea.type === SelectionTool.LASSO && selectionArea.points && selectionArea.points.length > 2) {\n      // 对于套索，我们需要创建一个临时画布\n      const tempCanvas = document.createElement('canvas');\n      const tempCtx = tempCanvas.getContext('2d');\n      if (!tempCtx) return null;\n\n      // 计算包围盒\n      const minX = Math.min(...selectionArea.points.map(p => p.x));\n      const minY = Math.min(...selectionArea.points.map(p => p.y));\n      const maxX = Math.max(...selectionArea.points.map(p => p.x));\n      const maxY = Math.max(...selectionArea.points.map(p => p.y));\n      const width = maxX - minX;\n      const height = maxY - minY;\n      tempCanvas.width = width;\n      tempCanvas.height = height;\n\n      // 创建套索形状\n      tempCtx.beginPath();\n      tempCtx.moveTo(selectionArea.points[0].x - minX, selectionArea.points[0].y - minY);\n      for (let i = 1; i < selectionArea.points.length; i++) {\n        tempCtx.lineTo(selectionArea.points[i].x - minX, selectionArea.points[i].y - minY);\n      }\n\n      // 裁剪\n      tempCtx.closePath();\n      tempCtx.clip();\n\n      // 绘制原图的选区部分\n      tempCtx.drawImage(canvas, minX, minY, width, height,\n      // 源矩形\n      0, 0, width, height // 目标矩形\n      );\n\n      // 获取图像数据\n      return tempCtx.getImageData(0, 0, width, height);\n    }\n    return null;\n  };\n\n  // 处理编辑操作\n  const handleEdit = async () => {\n    if (!selectionArea || !editingPrompt.trim()) return;\n    setIsProcessing(true);\n\n    // 获取选区图像数据\n    const imageData = getSelectionImageData();\n    if (!imageData) {\n      setIsProcessing(false);\n      return;\n    }\n\n    // 将图像数据转为 Base64\n    const tempCanvas = document.createElement('canvas');\n    tempCanvas.width = imageData.width;\n    tempCanvas.height = imageData.height;\n    const tempCtx = tempCanvas.getContext('2d');\n    if (!tempCtx) {\n      setIsProcessing(false);\n      return;\n    }\n    tempCtx.putImageData(imageData, 0, 0);\n    const base64Image = tempCanvas.toDataURL('image/png');\n    try {\n      // 模拟AI处理\n      console.log(`处理图像编辑，提示词：\"${editingPrompt}\"`);\n      console.log('选区信息:', selectionArea);\n      console.log('图像数据宽度:', imageData.width, '高度:', imageData.height);\n\n      // 模拟API调用\n      await new Promise(resolve => setTimeout(resolve, 2000));\n\n      // 在实际应用中，这里会向后端API发送请求\n      // const response = await fetch('/api/edit-image', {\n      //   method: 'POST',\n      //   headers: { 'Content-Type': 'application/json' },\n      //   body: JSON.stringify({\n      //     image: base64Image,\n      //     prompt: editingPrompt,\n      //     selectionType: selectionArea.type\n      //   })\n      // });\n      // const result = await response.json();\n      // const editedImageBase64 = result.editedImage;\n\n      // 假设这是处理后的图像结果(模拟)\n      // 为了演示，我们在这里简单修改原图像数据（增加亮度）\n      const editedImageData = simpleImageEdit(imageData);\n\n      // 应用编辑后的图像\n      applyEditedImage(editedImageData);\n\n      // 清除选区\n      setSelectionArea(null);\n      setEditingPrompt('');\n      alert('图像编辑完成！');\n    } catch (error) {\n      console.error('图像编辑失败:', error);\n      alert('图像编辑失败，请重试');\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  // 简单的图像编辑模拟（增加亮度）\n  const simpleImageEdit = imageData => {\n    const data = imageData.data.slice();\n\n    // 增加亮度（简单处理）\n    for (let i = 0; i < data.length; i += 4) {\n      data[i] = Math.min(255, data[i] + 50); // R\n      data[i + 1] = Math.min(255, data[i + 1] + 50); // G\n      data[i + 2] = Math.min(255, data[i + 2] + 50); // B\n    }\n    const newImageData = new ImageData(new Uint8ClampedArray(data), imageData.width, imageData.height);\n    return newImageData;\n  };\n\n  // 将编辑后的图像应用到原画布\n  const applyEditedImage = editedImageData => {\n    const canvas = canvasRef.current;\n    if (!canvas || !selectionArea) return;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n    if (selectionArea.type === SelectionTool.RECTANGLE && selectionArea.width && selectionArea.height) {\n      // 直接将编辑后的图像数据放回原位置\n      ctx.putImageData(editedImageData, selectionArea.x, selectionArea.y);\n    } else if (selectionArea.type === SelectionTool.LASSO && selectionArea.points && selectionArea.points.length > 2) {\n      // 对于套索，需要使用临时画布\n      const minX = Math.min(...selectionArea.points.map(p => p.x));\n      const minY = Math.min(...selectionArea.points.map(p => p.y));\n      const tempCanvas = document.createElement('canvas');\n      tempCanvas.width = editedImageData.width;\n      tempCanvas.height = editedImageData.height;\n      const tempCtx = tempCanvas.getContext('2d');\n      if (!tempCtx) return;\n\n      // 放置编辑后的图像数据\n      tempCtx.putImageData(editedImageData, 0, 0);\n\n      // 保存当前画布状态\n      ctx.save();\n\n      // 创建剪切路径\n      ctx.beginPath();\n      ctx.moveTo(selectionArea.points[0].x, selectionArea.points[0].y);\n      for (let i = 1; i < selectionArea.points.length; i++) {\n        ctx.lineTo(selectionArea.points[i].x, selectionArea.points[i].y);\n      }\n      ctx.closePath();\n      ctx.clip();\n\n      // 绘制编辑后的图像\n      ctx.drawImage(tempCanvas, 0, 0, tempCanvas.width, tempCanvas.height, minX, minY, tempCanvas.width, tempCanvas.height);\n\n      // 恢复画布状态\n      ctx.restore();\n    }\n\n    // 更新当前图像\n    updateCurrentImage();\n  };\n\n  // 更新当前图像引用\n  const updateCurrentImage = () => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const img = new Image();\n    img.src = canvas.toDataURL('image/png');\n    img.onload = () => {\n      imageRef.current = img;\n    };\n  };\n  if (!(state !== null && state !== void 0 && state.prompt)) {\n    return null;\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"home-container\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container mx-auto px-4 py-8\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-between mb-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleBackToPrompt,\n          className: \"flex items-center text-white hover:text-gray-200\",\n          children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n            xmlns: \"http://www.w3.org/2000/svg\",\n            className: \"h-5 w-5 mr-1\",\n            viewBox: \"0 0 20 20\",\n            fill: \"currentColor\",\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              fillRule: \"evenodd\",\n              d: \"M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z\",\n              clipRule: \"evenodd\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 576,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 575,\n            columnNumber: 13\n          }, this), \"\\u8FD4\\u56DE\\u63D0\\u793A\\u8A5E\\u7DE8\\u8F2F\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 571,\n          columnNumber: 11\n        }, this), showMindmapButton && /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleViewMindmap,\n          className: \"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors\",\n          children: [/*#__PURE__*/_jsxDEV(LightBulbIcon, {\n            className: \"w-5 h-5 mr-2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 586,\n            columnNumber: 15\n          }, this), \"\\u67E5\\u770B\\u5FC3\\u667A\\u5716\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 582,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 570,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"cm-card mb-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-xl font-bold mb-4 text-white\",\n          children: \"\\u539F\\u59CB\\u63D0\\u793A\\u8A5E\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 593,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-300 mb-6\",\n          children: state.prompt\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 594,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-xl font-bold mb-4 text-white\",\n          children: \"AI \\u512A\\u5316\\u5F8C\\u7684\\u63D0\\u793A\\u8A5E\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 596,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-white\",\n          children: refinedPrompt || '正在優化中...'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 597,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 592,\n        columnNumber: 9\n      }, this), loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center py-12\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 602,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-4 text-gray-300\",\n          children: \"\\u6B63\\u5728\\u751F\\u6210\\u8A2D\\u8A08...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 603,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 601,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6\",\n          children: mockImages.map((imageUrl, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `relative cursor-pointer rounded-lg overflow-hidden ${selectedImage === imageUrl ? 'ring-2 ring-purple-500' : ''}`,\n            onClick: () => handleImageSelect(imageUrl),\n            children: [/*#__PURE__*/_jsxDEV(\"img\", {\n              src: imageUrl,\n              alt: `設計方案 ${index + 1}`,\n              className: \"w-full h-48 object-cover\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 616,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"absolute bottom-0 left-0 right-0 bg-black bg-opacity-70 text-white p-2\",\n              children: [\"\\u8A2D\\u8A08\\u65B9\\u6848 \", index + 1]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 621,\n              columnNumber: 19\n            }, this)]\n          }, index, true, {\n            fileName: _jsxFileName,\n            lineNumber: 609,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 607,\n          columnNumber: 13\n        }, this), selectedImage && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"cm-card\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-xl font-bold mb-4 text-white\",\n            children: \"\\u5716\\u7247\\u7DE8\\u8F2F\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 630,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center space-x-4 mb-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-white\",\n              children: \"\\u9078\\u53D6\\u5DE5\\u5177\\uFF1A\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 634,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: `px-4 py-2 rounded-md ${activeTool === SelectionTool.RECTANGLE ? 'bg-purple-600 text-white' : 'bg-gray-700 text-gray-300'}`,\n              onClick: () => setActiveTool(SelectionTool.RECTANGLE),\n              children: \"\\u77E9\\u5F62\\u9078\\u53D6\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 635,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: `px-4 py-2 rounded-md ${activeTool === SelectionTool.LASSO ? 'bg-purple-600 text-white' : 'bg-gray-700 text-gray-300'}`,\n              onClick: () => setActiveTool(SelectionTool.LASSO),\n              children: \"\\u5957\\u7D22\\u9078\\u53D6\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 641,\n              columnNumber: 19\n            }, this), selectionArea && /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"px-4 py-2 bg-red-600 text-white rounded-md\",\n              onClick: cancelSelection,\n              children: \"\\u53D6\\u6D88\\u9078\\u53D6\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 648,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 633,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex justify-center mb-4 overflow-auto\",\n            children: /*#__PURE__*/_jsxDEV(\"canvas\", {\n              ref: canvasRef,\n              className: \"border border-gray-600 max-w-full max-h-[500px]\",\n              onMouseDown: handleMouseDown,\n              onMouseMove: handleMouseMove,\n              onMouseUp: handleMouseUp,\n              style: {\n                cursor: activeTool !== SelectionTool.NONE ? 'crosshair' : 'default'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 659,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 658,\n            columnNumber: 17\n          }, this), selectionArea && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mb-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"mb-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"block text-white mb-2\",\n                children: \"\\u7DE8\\u8F2F\\u63D0\\u793A\\u8A5E\\uFF1A\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 673,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                value: editingPrompt,\n                onChange: e => setEditingPrompt(e.target.value),\n                placeholder: \"\\u63CF\\u8FF0\\u60A8\\u60F3\\u8981\\u7684\\u4FEE\\u6539\\u6548\\u679C\",\n                className: \"w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-md text-white\",\n                disabled: isProcessing\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 674,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 672,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: handleEdit,\n              disabled: !editingPrompt.trim() || isProcessing,\n              className: `w-full px-4 py-2 rounded-md ${!editingPrompt.trim() || isProcessing ? 'bg-gray-700 text-gray-400 cursor-not-allowed' : 'bg-purple-600 text-white hover:bg-purple-700'}`,\n              children: isProcessing ? '處理中...' : '編輯圖片'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 683,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 671,\n            columnNumber: 19\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 629,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 569,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 568,\n    columnNumber: 5\n  }, this);\n};\n_s(Generator, \"/YiZLkVIxYm9b5G5yIJRg3kaVxw=\", false, function () {\n  return [useLocation, useNavigate];\n});\n_c = Generator;\nexport default Generator;\nvar _c;\n$RefreshReg$(_c, \"Generator\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useLocation","useNavigate","LightBulbIcon","jsxDEV","_jsxDEV","Fragment","_Fragment","SelectionTool","Generator","_s","location","navigate","state","refinedPrompt","setRefinedPrompt","loading","setLoading","selectedImage","setSelectedImage","showMindmapButton","setShowMindmapButton","canvasRef","imageRef","activeTool","setActiveTool","NONE","isSelecting","setIsSelecting","selectionArea","setSelectionArea","startPoint","setStartPoint","lassoPoints","setLassoPoints","editingPrompt","setEditingPrompt","isProcessing","setIsProcessing","mockImages","prompt","storedState","localStorage","getItem","parsedState","JSON","parse","console","log","loc","pathname","replace","error","setItem","stringify","simulatePromptRefinement","Promise","resolve","setTimeout","current","loadImageToCanvas","src","canvas","ctx","getContext","img","Image","crossOrigin","onload","width","height","clearRect","drawImage","handleImageSelect","imageUrl","handleBackToPrompt","productType","handleViewMindmap","initialPrompt","handleMouseDown","e","rect","getBoundingClientRect","x","clientX","left","y","clientY","top","LASSO","handleMouseMove","RECTANGLE","drawSelectionPreview","type","newPoints","drawLassoPreview","handleMouseUp","length","closedPoints","Math","min","map","p","points","redrawCanvas","selection","strokeStyle","lineWidth","setLineDash","strokeRect","fillStyle","fillRect","beginPath","moveTo","i","lineTo","stroke","fill","cancelSelection","getSelectionImageData","getImageData","tempCanvas","document","createElement","tempCtx","minX","minY","maxX","max","maxY","closePath","clip","handleEdit","trim","imageData","putImageData","base64Image","toDataURL","editedImageData","simpleImageEdit","applyEditedImage","alert","data","slice","newImageData","ImageData","Uint8ClampedArray","save","restore","updateCurrentImage","className","children","onClick","xmlns","viewBox","fillRule","d","clipRule","fileName","_jsxFileName","lineNumber","columnNumber","index","alt","ref","onMouseDown","onMouseMove","onMouseUp","style","cursor","value","onChange","target","placeholder","disabled","_c","$RefreshReg$"],"sources":["/Users/Dascupt/happysing_aws/frontend/src/pages/Generator.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport './Home.css'; // Import gradient styles\nimport { LightBulbIcon } from '@heroicons/react/24/outline';\n\n// 定义选择工具类型\nenum SelectionTool {\n  RECTANGLE = 'rectangle',\n  LASSO = 'lasso',\n  NONE = 'none'\n}\n\n// 定义选择区域的接口\ninterface SelectionArea {\n  x: number;\n  y: number;\n  width?: number;\n  height?: number;\n  points?: {x: number, y: number}[];\n  type: SelectionTool;\n}\n\ninterface LocationState {\n  productType: string;\n  prompt: string;\n}\n\nconst Generator: React.FC = () => {\n  const location = useLocation();\n  const navigate = useNavigate();\n  const state = location.state as LocationState;\n\n  const [refinedPrompt, setRefinedPrompt] = useState<string>('');\n  const [loading, setLoading] = useState<boolean>(true);\n  const [selectedImage, setSelectedImage] = useState<string>('');\n  const [showMindmapButton, setShowMindmapButton] = useState<boolean>(false);\n  \n  // Canvas相关状态\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const imageRef = useRef<HTMLImageElement | null>(null);\n  const [activeTool, setActiveTool] = useState<SelectionTool>(SelectionTool.NONE);\n  const [isSelecting, setIsSelecting] = useState<boolean>(false);\n  const [selectionArea, setSelectionArea] = useState<SelectionArea | null>(null);\n  const [startPoint, setStartPoint] = useState<{x: number, y: number} | null>(null);\n  const [lassoPoints, setLassoPoints] = useState<{x: number, y: number}[]>([]);\n  const [editingPrompt, setEditingPrompt] = useState<string>('');\n  const [isProcessing, setIsProcessing] = useState<boolean>(false);\n\n  // Mock images for demonstration\n  const mockImages = [\n    '/assets/design1.jpg',\n    '/assets/design1.jpg',\n    '/assets/design1.jpg'\n  ];\n\n  useEffect(() => {\n    // Try to restore from localStorage if state is missing\n    if (!state?.prompt) {\n      const storedState = localStorage.getItem('generator-last-state');\n      if (storedState) {\n        try {\n          const parsedState = JSON.parse(storedState);\n          if (parsedState && parsedState.prompt) {\n            console.log('Restored state from localStorage:', parsedState);\n            // Use the location.state setter provided by react-router\n            const loc = {\n              ...location,\n              state: parsedState\n            };\n            navigate(location.pathname, { \n              state: parsedState,\n              replace: true \n            });\n            return;\n          }\n        } catch (error) {\n          console.error('Error restoring state from localStorage:', error);\n        }\n      }\n      \n      // If no valid state was found in localStorage, redirect to home\n      console.log('No valid state found, redirecting to home');\n      navigate('/');\n      return;\n    }\n\n    // Save current state to localStorage for recovery\n    try {\n      localStorage.setItem('generator-last-state', JSON.stringify(state));\n    } catch (error) {\n      console.error('Error saving state to localStorage:', error);\n    }\n\n    const simulatePromptRefinement = async () => {\n      setLoading(true);\n      // Simulate API call delay\n      await new Promise(resolve => setTimeout(resolve, 1500));\n      \n      // Mock refined prompt\n      setRefinedPrompt(`${state.prompt} - 現代風格 - 鋁合金材質 - RGB燈效`);\n      setLoading(false);\n      \n      // Show mindmap button after content is loaded\n      setShowMindmapButton(true);\n    };\n\n    simulatePromptRefinement();\n  }, [state, navigate, location.pathname]);\n\n  // 选择图片后加载到Canvas\n  useEffect(() => {\n    if (selectedImage && canvasRef.current) {\n      loadImageToCanvas(selectedImage);\n    }\n  }, [selectedImage]);\n\n  // 加载图片到Canvas\n  const loadImageToCanvas = (src: string) => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    \n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    const img = new Image();\n    img.crossOrigin = 'anonymous';\n    img.onload = () => {\n      // 设置Canvas尺寸与图片一致\n      canvas.width = img.width;\n      canvas.height = img.height;\n      \n      // 清除Canvas并绘制图片\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n      \n      // 保存图片引用\n      imageRef.current = img;\n    };\n    img.src = src;\n  };\n\n  const handleImageSelect = (imageUrl: string) => {\n    setSelectedImage(imageUrl);\n    // 重置选区\n    setSelectionArea(null);\n    setActiveTool(SelectionTool.NONE);\n  };\n\n  const handleBackToPrompt = () => {\n    // Navigate back to the appropriate product page based on the product type\n    if (state?.productType) {\n      navigate(`/${state.productType}`);\n    } else {\n      navigate('/');\n    }\n  };\n\n  const handleViewMindmap = () => {\n    navigate('/mindmap', { \n      state: { \n        productType: state?.productType || 'cooler',\n        initialPrompt: state?.prompt\n      }\n    });\n  };\n\n  // Canvas 鼠标事件处理\n  const handleMouseDown = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (activeTool === SelectionTool.NONE || !canvasRef.current) return;\n    \n    setIsSelecting(true);\n    \n    const canvas = canvasRef.current;\n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    \n    setStartPoint({ x, y });\n    \n    if (activeTool === SelectionTool.LASSO) {\n      setLassoPoints([{ x, y }]);\n    }\n  };\n\n  const handleMouseMove = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (!isSelecting || !canvasRef.current || !startPoint) return;\n    \n    const canvas = canvasRef.current;\n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    \n    if (activeTool === SelectionTool.RECTANGLE) {\n      drawSelectionPreview({\n        x: startPoint.x,\n        y: startPoint.y,\n        width: x - startPoint.x,\n        height: y - startPoint.y,\n        type: SelectionTool.RECTANGLE\n      });\n    } else if (activeTool === SelectionTool.LASSO) {\n      const newPoints = [...lassoPoints, { x, y }];\n      setLassoPoints(newPoints);\n      drawLassoPreview(newPoints);\n    }\n  };\n\n  const handleMouseUp = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (!isSelecting || !canvasRef.current || !startPoint) return;\n    \n    setIsSelecting(false);\n    \n    const canvas = canvasRef.current;\n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    \n    if (activeTool === SelectionTool.RECTANGLE) {\n      setSelectionArea({\n        x: startPoint.x,\n        y: startPoint.y,\n        width: x - startPoint.x,\n        height: y - startPoint.y,\n        type: SelectionTool.RECTANGLE\n      });\n    } else if (activeTool === SelectionTool.LASSO && lassoPoints.length > 2) {\n      // 闭合套索\n      const closedPoints = [...lassoPoints, lassoPoints[0]];\n      setLassoPoints(closedPoints);\n      setSelectionArea({\n        x: Math.min(...closedPoints.map(p => p.x)),\n        y: Math.min(...closedPoints.map(p => p.y)),\n        points: closedPoints,\n        type: SelectionTool.LASSO\n      });\n    }\n    \n    redrawCanvas();\n  };\n\n  // 绘制矩形选择预览\n  const drawSelectionPreview = (selection: SelectionArea) => {\n    const canvas = canvasRef.current;\n    if (!canvas || !selection.width || !selection.height) return;\n    \n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n    \n    // 重绘原图\n    redrawCanvas();\n    \n    // 绘制选择矩形\n    ctx.strokeStyle = '#ff0000';\n    ctx.lineWidth = 2;\n    ctx.setLineDash([5, 5]);\n    ctx.strokeRect(selection.x, selection.y, selection.width, selection.height);\n    \n    // 创建半透明遮罩\n    ctx.fillStyle = 'rgba(255, 0, 0, 0.2)';\n    ctx.fillRect(selection.x, selection.y, selection.width, selection.height);\n  };\n\n  // 绘制套索选择预览\n  const drawLassoPreview = (points: {x: number, y: number}[]) => {\n    const canvas = canvasRef.current;\n    if (!canvas || points.length < 2) return;\n    \n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n    \n    // 重绘原图\n    redrawCanvas();\n    \n    // 绘制套索路径\n    ctx.beginPath();\n    ctx.moveTo(points[0].x, points[0].y);\n    \n    for (let i = 1; i < points.length; i++) {\n      ctx.lineTo(points[i].x, points[i].y);\n    }\n    \n    ctx.strokeStyle = '#ff0000';\n    ctx.lineWidth = 2;\n    ctx.setLineDash([5, 5]);\n    ctx.stroke();\n    \n    // 如果点足够多，填充半透明遮罩\n    if (points.length > 2) {\n      ctx.fillStyle = 'rgba(255, 0, 0, 0.2)';\n      ctx.fill();\n    }\n  };\n\n  // 重绘Canvas\n  const redrawCanvas = () => {\n    const canvas = canvasRef.current;\n    const img = imageRef.current;\n    \n    if (!canvas || !img) return;\n    \n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n    \n    // 清除画布\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    \n    // 绘制图片\n    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n    \n    // 绘制当前选区\n    if (selectionArea) {\n      if (selectionArea.type === SelectionTool.RECTANGLE && selectionArea.width && selectionArea.height) {\n        ctx.strokeStyle = '#ff0000';\n        ctx.lineWidth = 2;\n        ctx.setLineDash([5, 5]);\n        ctx.strokeRect(selectionArea.x, selectionArea.y, selectionArea.width, selectionArea.height);\n        ctx.fillStyle = 'rgba(255, 0, 0, 0.2)';\n        ctx.fillRect(selectionArea.x, selectionArea.y, selectionArea.width, selectionArea.height);\n      } else if (selectionArea.type === SelectionTool.LASSO && selectionArea.points && selectionArea.points.length > 2) {\n        ctx.beginPath();\n        ctx.moveTo(selectionArea.points[0].x, selectionArea.points[0].y);\n        \n        for (let i = 1; i < selectionArea.points.length; i++) {\n          ctx.lineTo(selectionArea.points[i].x, selectionArea.points[i].y);\n        }\n        \n        ctx.strokeStyle = '#ff0000';\n        ctx.lineWidth = 2;\n        ctx.setLineDash([5, 5]);\n        ctx.stroke();\n        ctx.fillStyle = 'rgba(255, 0, 0, 0.2)';\n        ctx.fill();\n      }\n    }\n  };\n\n  // 取消选择\n  const cancelSelection = () => {\n    setSelectionArea(null);\n    setActiveTool(SelectionTool.NONE);\n    redrawCanvas();\n  };\n\n  // 获取选区图像数据\n  const getSelectionImageData = () => {\n    const canvas = canvasRef.current;\n    if (!canvas || !selectionArea) return null;\n    \n    const ctx = canvas.getContext('2d');\n    if (!ctx) return null;\n    \n    if (selectionArea.type === SelectionTool.RECTANGLE && selectionArea.width && selectionArea.height) {\n      // 获取矩形区域的图像数据\n      return ctx.getImageData(\n        selectionArea.x, \n        selectionArea.y, \n        selectionArea.width, \n        selectionArea.height\n      );\n    } else if (selectionArea.type === SelectionTool.LASSO && selectionArea.points && selectionArea.points.length > 2) {\n      // 对于套索，我们需要创建一个临时画布\n      const tempCanvas = document.createElement('canvas');\n      const tempCtx = tempCanvas.getContext('2d');\n      if (!tempCtx) return null;\n      \n      // 计算包围盒\n      const minX = Math.min(...selectionArea.points.map(p => p.x));\n      const minY = Math.min(...selectionArea.points.map(p => p.y));\n      const maxX = Math.max(...selectionArea.points.map(p => p.x));\n      const maxY = Math.max(...selectionArea.points.map(p => p.y));\n      \n      const width = maxX - minX;\n      const height = maxY - minY;\n      \n      tempCanvas.width = width;\n      tempCanvas.height = height;\n      \n      // 创建套索形状\n      tempCtx.beginPath();\n      tempCtx.moveTo(selectionArea.points[0].x - minX, selectionArea.points[0].y - minY);\n      \n      for (let i = 1; i < selectionArea.points.length; i++) {\n        tempCtx.lineTo(selectionArea.points[i].x - minX, selectionArea.points[i].y - minY);\n      }\n      \n      // 裁剪\n      tempCtx.closePath();\n      tempCtx.clip();\n      \n      // 绘制原图的选区部分\n      tempCtx.drawImage(canvas, \n        minX, minY, width, height,  // 源矩形\n        0, 0, width, height         // 目标矩形\n      );\n      \n      // 获取图像数据\n      return tempCtx.getImageData(0, 0, width, height);\n    }\n    \n    return null;\n  };\n\n  // 处理编辑操作\n  const handleEdit = async () => {\n    if (!selectionArea || !editingPrompt.trim()) return;\n    \n    setIsProcessing(true);\n    \n    // 获取选区图像数据\n    const imageData = getSelectionImageData();\n    if (!imageData) {\n      setIsProcessing(false);\n      return;\n    }\n    \n    // 将图像数据转为 Base64\n    const tempCanvas = document.createElement('canvas');\n    tempCanvas.width = imageData.width;\n    tempCanvas.height = imageData.height;\n    \n    const tempCtx = tempCanvas.getContext('2d');\n    if (!tempCtx) {\n      setIsProcessing(false);\n      return;\n    }\n    \n    tempCtx.putImageData(imageData, 0, 0);\n    const base64Image = tempCanvas.toDataURL('image/png');\n    \n    try {\n      // 模拟AI处理\n      console.log(`处理图像编辑，提示词：\"${editingPrompt}\"`);\n      console.log('选区信息:', selectionArea);\n      console.log('图像数据宽度:', imageData.width, '高度:', imageData.height);\n      \n      // 模拟API调用\n      await new Promise(resolve => setTimeout(resolve, 2000));\n      \n      // 在实际应用中，这里会向后端API发送请求\n      // const response = await fetch('/api/edit-image', {\n      //   method: 'POST',\n      //   headers: { 'Content-Type': 'application/json' },\n      //   body: JSON.stringify({\n      //     image: base64Image,\n      //     prompt: editingPrompt,\n      //     selectionType: selectionArea.type\n      //   })\n      // });\n      // const result = await response.json();\n      // const editedImageBase64 = result.editedImage;\n      \n      // 假设这是处理后的图像结果(模拟)\n      // 为了演示，我们在这里简单修改原图像数据（增加亮度）\n      const editedImageData = simpleImageEdit(imageData);\n      \n      // 应用编辑后的图像\n      applyEditedImage(editedImageData);\n      \n      // 清除选区\n      setSelectionArea(null);\n      setEditingPrompt('');\n      \n      alert('图像编辑完成！');\n    } catch (error) {\n      console.error('图像编辑失败:', error);\n      alert('图像编辑失败，请重试');\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  // 简单的图像编辑模拟（增加亮度）\n  const simpleImageEdit = (imageData: ImageData) => {\n    const data = imageData.data.slice();\n    \n    // 增加亮度（简单处理）\n    for (let i = 0; i < data.length; i += 4) {\n      data[i] = Math.min(255, data[i] + 50);       // R\n      data[i + 1] = Math.min(255, data[i + 1] + 50); // G\n      data[i + 2] = Math.min(255, data[i + 2] + 50); // B\n    }\n    \n    const newImageData = new ImageData(\n      new Uint8ClampedArray(data), \n      imageData.width, \n      imageData.height\n    );\n    \n    return newImageData;\n  };\n\n  // 将编辑后的图像应用到原画布\n  const applyEditedImage = (editedImageData: ImageData) => {\n    const canvas = canvasRef.current;\n    if (!canvas || !selectionArea) return;\n    \n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n    \n    if (selectionArea.type === SelectionTool.RECTANGLE && selectionArea.width && selectionArea.height) {\n      // 直接将编辑后的图像数据放回原位置\n      ctx.putImageData(\n        editedImageData, \n        selectionArea.x, \n        selectionArea.y\n      );\n    } else if (selectionArea.type === SelectionTool.LASSO && selectionArea.points && selectionArea.points.length > 2) {\n      // 对于套索，需要使用临时画布\n      const minX = Math.min(...selectionArea.points.map(p => p.x));\n      const minY = Math.min(...selectionArea.points.map(p => p.y));\n      \n      const tempCanvas = document.createElement('canvas');\n      tempCanvas.width = editedImageData.width;\n      tempCanvas.height = editedImageData.height;\n      \n      const tempCtx = tempCanvas.getContext('2d');\n      if (!tempCtx) return;\n      \n      // 放置编辑后的图像数据\n      tempCtx.putImageData(editedImageData, 0, 0);\n      \n      // 保存当前画布状态\n      ctx.save();\n      \n      // 创建剪切路径\n      ctx.beginPath();\n      ctx.moveTo(selectionArea.points[0].x, selectionArea.points[0].y);\n      \n      for (let i = 1; i < selectionArea.points.length; i++) {\n        ctx.lineTo(selectionArea.points[i].x, selectionArea.points[i].y);\n      }\n      \n      ctx.closePath();\n      ctx.clip();\n      \n      // 绘制编辑后的图像\n      ctx.drawImage(\n        tempCanvas, \n        0, 0, tempCanvas.width, tempCanvas.height,\n        minX, minY, tempCanvas.width, tempCanvas.height\n      );\n      \n      // 恢复画布状态\n      ctx.restore();\n    }\n    \n    // 更新当前图像\n    updateCurrentImage();\n  };\n\n  // 更新当前图像引用\n  const updateCurrentImage = () => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    \n    const img = new Image();\n    img.src = canvas.toDataURL('image/png');\n    img.onload = () => {\n      imageRef.current = img;\n    };\n  };\n\n  if (!state?.prompt) {\n    return null;\n  }\n\n  return (\n    <div className=\"home-container\">\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <button \n            onClick={handleBackToPrompt}\n            className=\"flex items-center text-white hover:text-gray-200\"\n          >\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 mr-1\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n              <path fillRule=\"evenodd\" d=\"M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z\" clipRule=\"evenodd\" />\n            </svg>\n            返回提示詞編輯\n          </button>\n          \n          {showMindmapButton && (\n            <button\n              onClick={handleViewMindmap}\n              className=\"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors\"\n            >\n              <LightBulbIcon className=\"w-5 h-5 mr-2\" />\n              查看心智圖\n            </button>\n          )}\n        </div>\n\n        <div className=\"cm-card mb-6\">\n          <h2 className=\"text-xl font-bold mb-4 text-white\">原始提示詞</h2>\n          <p className=\"text-gray-300 mb-6\">{state.prompt}</p>\n          \n          <h2 className=\"text-xl font-bold mb-4 text-white\">AI 優化後的提示詞</h2>\n          <p className=\"text-white\">{refinedPrompt || '正在優化中...'}</p>\n        </div>\n\n        {loading ? (\n          <div className=\"text-center py-12\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto\"></div>\n            <p className=\"mt-4 text-gray-300\">正在生成設計...</p>\n          </div>\n        ) : (\n          <>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6\">\n              {mockImages.map((imageUrl, index) => (\n                <div\n                  key={index}\n                  className={`relative cursor-pointer rounded-lg overflow-hidden ${\n                    selectedImage === imageUrl ? 'ring-2 ring-purple-500' : ''\n                  }`}\n                  onClick={() => handleImageSelect(imageUrl)}\n                >\n                  <img\n                    src={imageUrl}\n                    alt={`設計方案 ${index + 1}`}\n                    className=\"w-full h-48 object-cover\"\n                  />\n                  <div className=\"absolute bottom-0 left-0 right-0 bg-black bg-opacity-70 text-white p-2\">\n                    設計方案 {index + 1}\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            {selectedImage && (\n              <div className=\"cm-card\">\n                <h2 className=\"text-xl font-bold mb-4 text-white\">圖片編輯</h2>\n                \n                {/* 选择工具 */}\n                <div className=\"flex items-center space-x-4 mb-4\">\n                  <span className=\"text-white\">選取工具：</span>\n                  <button\n                    className={`px-4 py-2 rounded-md ${activeTool === SelectionTool.RECTANGLE ? 'bg-purple-600 text-white' : 'bg-gray-700 text-gray-300'}`}\n                    onClick={() => setActiveTool(SelectionTool.RECTANGLE)}\n                  >\n                    矩形選取\n                  </button>\n                  <button\n                    className={`px-4 py-2 rounded-md ${activeTool === SelectionTool.LASSO ? 'bg-purple-600 text-white' : 'bg-gray-700 text-gray-300'}`}\n                    onClick={() => setActiveTool(SelectionTool.LASSO)}\n                  >\n                    套索選取\n                  </button>\n                  {selectionArea && (\n                    <button\n                      className=\"px-4 py-2 bg-red-600 text-white rounded-md\"\n                      onClick={cancelSelection}\n                    >\n                      取消選取\n                    </button>\n                  )}\n                </div>\n                \n                {/* Canvas 绘图区域 */}\n                <div className=\"flex justify-center mb-4 overflow-auto\">\n                  <canvas\n                    ref={canvasRef}\n                    className=\"border border-gray-600 max-w-full max-h-[500px]\"\n                    onMouseDown={handleMouseDown}\n                    onMouseMove={handleMouseMove}\n                    onMouseUp={handleMouseUp}\n                    style={{ cursor: activeTool !== SelectionTool.NONE ? 'crosshair' : 'default' }}\n                  />\n                </div>\n                \n                {/* 编辑控制区域 */}\n                {selectionArea && (\n                  <div className=\"mb-4\">\n                    <div className=\"mb-3\">\n                      <label className=\"block text-white mb-2\">編輯提示詞：</label>\n                      <input\n                        type=\"text\"\n                        value={editingPrompt}\n                        onChange={(e) => setEditingPrompt(e.target.value)}\n                        placeholder=\"描述您想要的修改效果\"\n                        className=\"w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-md text-white\"\n                        disabled={isProcessing}\n                      />\n                    </div>\n                    <button\n                      onClick={handleEdit}\n                      disabled={!editingPrompt.trim() || isProcessing}\n                      className={`w-full px-4 py-2 rounded-md ${\n                        !editingPrompt.trim() || isProcessing\n                          ? 'bg-gray-700 text-gray-400 cursor-not-allowed'\n                          : 'bg-purple-600 text-white hover:bg-purple-700'\n                      }`}\n                    >\n                      {isProcessing ? '處理中...' : '編輯圖片'}\n                    </button>\n                  </div>\n                )}\n              </div>\n            )}\n          </>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default Generator; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}